
**NOTE:** This code doesn't work, there is something wrong with the code
### Step 1: Add Internet Permission

Make sure your `AndroidManifest.xml` includes:



```xml
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```


## What Is a Real-Time Connectivity Listener?

It‚Äôs a way to **observe network changes** (Wi-Fi, mobile data, airplane mode, etc.) using Android‚Äôs `ConnectivityManager` and Kotlin‚Äôs `callbackFlow`. In Compose, we wrap this in a `produceState` so your UI can react automatically.

## üõ† Step-by-Step Setup

### 1. **Create a Connectivity Observer Utility**

```
utils/
‚îî‚îÄ‚îÄ NetworkUtils.kt

```

```kotlin
import android.content.Context
import android.net.*
import kotlinx.coroutines.channels.awaitClose
import kotlinx.coroutines.flow.callbackFlow
import kotlinx.coroutines.flow.distinctUntilChanged

fun Context.observeConnectivity(): kotlinx.coroutines.flow.Flow<Boolean> = callbackFlow {
    val connectivityManager = getSystemService(Context.CONNECTIVITY_SERVICE) as ConnectivityManager

    val callback = object : ConnectivityManager.NetworkCallback() {
        override fun onAvailable(network: Network) {
            trySend(true)
        }

        override fun onLost(network: Network) {
            trySend(false)
        }
    }

    val request = NetworkRequest.Builder()
        .addCapability(NetworkCapabilities.NET_CAPABILITY_INTERNET)
        .build()

    connectivityManager.registerNetworkCallback(request, callback)

    awaitClose {
        connectivityManager.unregisterNetworkCallback(callback)
    }
}.distinctUntilChanged()
```

> üîç This emits `true` when internet is available, and `false` when it‚Äôs lost.

### 2. **Use It in Compose with** `produceState`

```
ui/components/
‚îî‚îÄ‚îÄ NetworkStateComposable.kt
```


```kotlin

import androidx.compose.runtime.Composable  
import androidx.compose.runtime.State  
import androidx.compose.runtime.produceState  
import androidx.compose.ui.platform.LocalContext  
import com.example.retrokoin.utils.observeConnectivity

@Composable
fun rememberConnectivityState(): State<Boolean> {
    val context = LocalContext.current
    return produceState(initialValue = true) {
        context.observeConnectivity().collect { value = it }
    }
}
```

### 3. **React in Your UI**

In your `PostListScreen`, you can do:



```kotlin
val isConnected by rememberConnectivityState()

if (!isConnected) {
    Text("No internet connection", color = MaterialTheme.colorScheme.error)
} else if (posts.isEmpty()) {
    LaunchedEffect(Unit) {
        viewModel.fetchPosts() // Make this public in your ViewModel
    }
    CircularProgressIndicator()
} else {
    LazyColumn { /* show posts */ }
}
```

## üß† Why This Is Powerful

- ‚úÖ Automatically reacts to network changes
    
- ‚úÖ No need to restart the app
    
- ‚úÖ Works with Compose‚Äôs reactive model
    
- ‚úÖ You can show a Snackbar, retry fetches, or disable buttons