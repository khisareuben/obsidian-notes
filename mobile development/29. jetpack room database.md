

1. **Create the columns of the database** : These are the different sections that will be in your database /data

```kotlin
import androidx.room.Entity  
import androidx.room.PrimaryKey  
  
@Entity  
data class Note(  
    val title: String,  
    val description: String,  
    val date: String,  
    @PrimaryKey(autoGenerate = true)  
    val id: Int = 0  
  
)
```


2. **Create the Dao(Data access object)** : This will help interact with the database and performing functions like insert, delete, update /data

```kotlin
import androidx.room.Dao  
import androidx.room.Delete  
import androidx.room.Query  
import androidx.room.Upsert  
import kotlinx.coroutines.flow.Flow  
  
@Dao  
interface NoteDao {  
  
    @Upsert  
    suspend fun upsertNote(note: Note)  
  
    @Delete  
    suspend fun deleteNote(note: Note)  
  
    @Query("SELECT * FROM note ORDER BY date")  
    fun getNotesOrderedByDate(): Flow<List<Note>>  
  
    @Query("SELECT * FROM note ORDER BY title ASC")  
    fun getNotesOrderedByTitle(): Flow<List<Note>>  
  
  
}
```


3. **Create the database** : This will integrate the columns and the dao together /data

```kotlin
import androidx.room.Database  
import androidx.room.RoomDatabase  
  
@Database(  
    entities = [Note::class],  
    version = 1  
)  
abstract class NotesDatabase: RoomDatabase() {  
    abstract val dao: NoteDao  
}
```


4. Create a notes event /presentation

```kotlin
import com.example.todo.roomdatabase.data.Note  
  
sealed interface NotesEvent {  
  
    object  SortNotes: NotesEvent  
  
    data class DeleteNote(val note: Note): NotesEvent  
  
    data class SaveNote(  
        val title: String,  
        val description: String,  
    ): NotesEvent  
  
  
}
```


5. Create a state for your screen /presentation

```kotlin
import androidx.compose.runtime.MutableState  
import androidx.compose.runtime.mutableStateOf  
import com.example.todo.roomdatabase.data.Note  
  
data class NoteState(  
    val notes: List<Note> = emptyList(),  
    val title: MutableState<String> = mutableStateOf(""),  
    val description: MutableState<String> = mutableStateOf("")  
)
```


6. Create your viewModel /presentation

```kotlin
import androidx.compose.runtime.mutableStateOf  
import androidx.lifecycle.ViewModel  
import androidx.lifecycle.viewModelScope  
import com.example.todo.roomdatabase.data.Note  
import com.example.todo.roomdatabase.data.NoteDao  
import kotlinx.coroutines.ExperimentalCoroutinesApi  
import kotlinx.coroutines.flow.MutableStateFlow  
import kotlinx.coroutines.flow.SharingStarted  
import kotlinx.coroutines.flow.combine  
import kotlinx.coroutines.flow.flatMapLatest  
import kotlinx.coroutines.flow.stateIn  
import kotlinx.coroutines.flow.update  
import kotlinx.coroutines.launch  
  
class NotesViewModel(private val dao: NoteDao): ViewModel() {  
  
    private val isSortedByDateAdded = MutableStateFlow(true)  
  
    @OptIn(ExperimentalCoroutinesApi::class)  
    private var notes =  
        isSortedByDateAdded.flatMapLatest { sort ->  
            if (sort) {  
                dao.getNotesOrderedByDate()  
            } else {  
                dao.getNotesOrderedByTitle()  
            }  
        }.stateIn(viewModelScope, SharingStarted.WhileSubscribed(), emptyList())  
  
    val _state = MutableStateFlow(NoteState())  
    val state = combine(_state, notes, isSortedByDateAdded) { state, notes, isSortedByDateAdded ->  
        state.copy(  
            notes = notes,  
        )  
    }.stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), NoteState())  
  
    fun onEvent(event: NotesEvent) {  
        when(event) {  
            is NotesEvent.DeleteNote -> {  
                viewModelScope.launch {  
                    dao.deleteNote(event.note)  
                }  
  
            }  
            is NotesEvent.SaveNote -> {  
                val note = Note(  
                        title = event.title,  
                        description = event.description,  
                        date = System.currentTimeMillis().toString()  
  
                )  
                viewModelScope.launch {  
                    dao.upsertNote(note)  
                }  
                _state.update {  
                    it.copy(  
                        title = mutableStateOf(""),  
                        description = mutableStateOf("")  
                    )  
                }  
            }  
            is NotesEvent.SortNotes -> {  
                isSortedByDateAdded.value = !isSortedByDateAdded.value  
            }  
        }  
    }  
  
}
```