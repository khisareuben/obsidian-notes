

## Step-by-Step: Room + ViewModel + Koin + Jetpack Compose

### ‚úÖ 1. Add Koin Dependencies

In your `build.gradle` (app-level):



```groovy
plugins {
    id 'kotlin-kapt'
}

dependencies {
    // Koin core
    implementation("io.insert-koin:koin-android:4.1.0")  
	implementation("io.insert-koin:koin-androidx-compose:4.1.0")

    // Room
    implementation "androidx.room:room-runtime:2.6.1"
    kapt "androidx.room:room-compiler:2.6.1"
    implementation "androidx.room:room-ktx:2.6.1"

    // ViewModel
    implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0"
}
```

#### ‚úÖ 1. **Create the columns of the database** : These are the different sections that will be in your database /data
#### `Note.kt`



```kotlin
@Entity  
data class Todo(  
    val title: String,  
    val body: String,  
    @PrimaryKey(autoGenerate = true)  
    val id: Int = 0  
)
```

#### `NoteDao.kt`

#### 2. **Create the Dao(Data access object)** : This will help interact with the database and performing functions like insert, delete, update /data

```kotlin
@Dao  
interface TodoDao {  
  
    @Query("SELECT * FROM todo")  
    fun getAllData(): Flow<List<Todo>>  
  
    @Insert(onConflict = OnConflictStrategy.REPLACE)  
    suspend fun upsertData(todo: Todo)  
  
    @Update  
    suspend fun updateData(todo: Todo)  
  
    @Delete  
    suspend fun deleteData(todo: Todo)  
}
```

#### `NoteDatabase.kt`

#### **Create the database** : This will integrate the columns and the dao together /data

```kotlin
@Database(entities = [Todo::class], version = 1)  
abstract class TodoDatabase: RoomDatabase() {  
  
    abstract fun getDao(): TodoDao  
  
}
```

### ‚úÖ 3. Create Repository and ViewModel

#### `NoteRepository.kt`

#### 4. Create a notes event (real action)/presentation

```kotlin

class TodoRepository(private val dao: TodoDao) {  
  
    fun getAllData(): Flow<List<Todo>> = dao.getAllData()  
  
    suspend fun upsertData(todo: Todo) = dao.upsertData(todo)  
  
    suspend fun updateData(todo: Todo) = dao.updateData(todo)  
  
    suspend fun deleteData(todo: Todo) = dao.deleteData(todo)  
}

```

#### `NoteViewModel.kt`

#### 5. Create your viewModel /presentation

```kotlin

class MyViewModel(private val repository: TodoRepository) : ViewModel() {  
  
    val notesList: StateFlow<List<Todo>> = repository  
        .getAllData()  
        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), emptyList())  
  
    fun upsertData(todo: Todo) {  
        viewModelScope.launch {  
            repository.upsertData(todo)  
        }  
    }  
  
    fun updateData(todo: Todo) {  
        viewModelScope.launch {  
            repository.updateData(todo)  
        }  
    }  
  
    fun deleteData(todo: Todo) {  
        viewModelScope.launch {  
            repository.deleteData(todo)  
        }  
    }  
}

```



## What Is a Koin Module?

A **Koin module** is like a **recipe** that tells Koin how to create and provide the things your app needs‚Äîlike your database, DAO, repository, and ViewModel.

You write this recipe once, and Koin uses it to "cook up" the objects whenever your app asks for them.

## üß© Let's Break Down the Koin Module Line by Line

Here‚Äôs the code again:



```kotlin
val appModule = module {  
  
    single {  
        Room.databaseBuilder(  
            get(),  
            TodoDatabase::class.java,  
            "todo.db"  
        ).build()  
    }  
    single { get<TodoDatabase>().getDao() }  
    single { TodoRepository(get()) }  
    viewModel { MyViewModel(get()) }  
  
}
```

Now let‚Äôs explain each line:

### üß± `single { ... }` ‚Äî What Does It Mean?

- `single` means: ‚ÄúKoin, please create **one instance** of this and reuse it everywhere.‚Äù
    
- It‚Äôs like saying: ‚ÄúMake one database, one DAO, one repository, and share them.‚Äù
    

### üîπ Line 1: Create the Room Database



```kotlin
single {
    Room.databaseBuilder(get(), NoteDatabase::class.java, "note.db").build()
}
```

- This tells Koin how to create your Room database.
    
- `get()` means: ‚ÄúKoin, give me the `Context` (which it already knows from your Application).‚Äù
    
- So this line is the same as:
    
    
    
    ```kotlin
    Room.databaseBuilder(applicationContext, NoteDatabase::class.java, "note.db").build()
    ```
    

‚úÖ Now Koin knows how to build your database.

### üîπ Line 2: Create the DAO



```kotlin
single { get<NoteDatabase>().noteDao() }
```

- This says: ‚ÄúKoin, get the `NoteDatabase` you just created, and call `.noteDao()` on it.‚Äù
    
- So now Koin knows how to give you the DAO (Data Access Object).
    

‚úÖ Now Koin can give you the DAO whenever you need it.

### üîπ Line 3: Create the Repository



```kotlin
single { NoteRepository(get()) }
```

- This says: ‚ÄúKoin, create a `NoteRepository`, and give it the DAO you just created.‚Äù
    
- `get()` here means: ‚ÄúGive me the DAO.‚Äù
    

‚úÖ Now Koin knows how to build your repository.

### üîπ Line 4: Create the ViewModel



```kotlin
viewModel { NoteViewModel(get()) }
```

- This says: ‚ÄúKoin, create a `NoteViewModel`, and give it the repository.‚Äù
    
- `viewModel {}` is a special Koin function that knows how to work with Android‚Äôs ViewModel system.
    

‚úÖ Now Koin can give you the ViewModel in your UI code.

## üß† Summary of the Flow

Here‚Äôs how everything connects:

```
Context (from Application)
   ‚Üì
Room.databaseBuilder(...) ‚Üí NoteDatabase
   ‚Üì
NoteDatabase.noteDao() ‚Üí NoteDao
   ‚Üì
NoteRepository(NoteDao)
   ‚Üì
NoteViewModel(NoteRepository)
```

Koin builds this chain for you automatically. You just describe how to build each piece.

## üß™ Do You Need to Memorize This?

No! But you should understand the pattern:

- `single { ... }` ‚Üí For things you want one copy of (like database, DAO, repository)
    
- `viewModel { ... }` ‚Üí For ViewModels
    
- `get<T>()` ‚Üí Ask Koin to give you something it already knows how to build
    

Once you understand this pattern, you can build anything with Koin.


This is the UI but its not complete so put it in a function and pass the viewmodel as an argument...


```kotlin

@Composable  
fun MainUI(  
    viewModel: MyViewModel = koinViewModel()  
) {  
    val notes by viewModel.notesList.collectAsState()  
  
    var showDialog by remember { mutableStateOf(false) }  
    var name by remember { mutableStateOf("") }  
    var body by remember { mutableStateOf("") }  
    var noteToDelete by remember { mutableStateOf<Todo?>(null) }  
    var noteToEdit by remember { mutableStateOf<Todo?>(null) }  
  
    Surface(  
        modifier = Modifier.fillMaxSize(),  
        color = MaterialTheme.colorScheme.background  
    ) {  
        Column(  
            modifier = Modifier.padding(16.dp),  
            verticalArrangement = Arrangement.spacedBy(12.dp)  
        ) {  
            TextField(  
                value = name,  
                onValueChange = { name = it },  
                placeholder = { Text("Title") }  
            )  
            TextField(  
                value = body,  
                onValueChange = { body = it },  
                placeholder = { Text("Body") }  
            )  
            Button(onClick = {  
                if (noteToEdit != null) {  
                    val updated = noteToEdit!!.copy(title = name, body = body)  
                    viewModel.updateData(updated)  
                    noteToEdit = null  
                } else {  
                    val todo = Todo(title = name, body = body)  
                    viewModel.upsertData(todo)  
                }  
                name = ""  
                body = ""  
            }) {  
                Text(if (noteToEdit != null) "Update Note" else "Add Note")  
            }  
  
            LazyColumn {  
                items(notes) { note ->  
                    Card(  
                        modifier = Modifier  
                            .fillMaxWidth()  
                            .clickable {  
                                name = note.title  
                                body = note.body  
                                noteToEdit = note  
                            }  
                            .combinedClickable(  
                                onClick = {  
                                    name = note.title  
                                    body = note.body  
                                    noteToEdit = note  
                                },  
                                onLongClick = {  
                                    noteToDelete = note  
                                    showDialog = true  
                                }  
                            ),  
                        elevation = CardDefaults.cardElevation(4.dp)  
                    ) {  
                        Column(modifier = Modifier.padding(12.dp)) {  
                            Text(text = note.title, style = MaterialTheme.typography.titleMedium)  
                            Text(text = note.body, style = MaterialTheme.typography.bodyMedium)  
                        }  
                    }                    Spacer(modifier = Modifier.padding(10.dp))  
                }  
            }        }  
        if (showDialog && noteToDelete != null) {  
            AlertDialog(  
                onDismissRequest = {  
                    showDialog = false  
                    noteToDelete = null  
                },  
                title = { Text("Delete Note") },  
                text = { Text("Are you sure you want to delete '${noteToDelete?.title}'?") },  
                confirmButton = {  
                    TextButton(onClick = {  
                        noteToDelete?.let { viewModel.deleteData(it) }  
                        showDialog = false  
                        noteToDelete = null  
                    }) {  
                        Text("Yes")  
                    }  
                },  
                dismissButton = {  
                    TextButton(onClick = {  
                        showDialog = false  
                        noteToDelete = null  
                    }) {  
                        Text("No")  
                    }  
                }            )  
        }  
    }  
}

```