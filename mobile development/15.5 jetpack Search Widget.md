
This is implementing the search bar in the top app bar


# Create the Textfield impl first

```kotlin

@Composable  
fun SearchAppBar(  
    text: String,  
    onTextChange: (String) -> Unit,  
    onCloseClicked: () -> Unit,  
    onSearchClicked: (String) -> Unit  
) {  
  
    Surface(  
        modifier = Modifier  
            .fillMaxWidth()  
            .height(56.dp),  
        tonalElevation = 20.dp,  
        color = MaterialTheme.colorScheme.primary  
    ) {  
        TextField(  
            modifier = Modifier  
                .fillMaxWidth(),  
            value = text,  
            onValueChange = {onTextChange(it)},  
            placeholder = {  
                Text(  
                    modifier = Modifier.alpha(0.5F),  
                    text = "Search here...",  
                    color = Color.White  
                )  
            },  
            singleLine = true,  
            leadingIcon = {  
                IconButton(  
                    modifier = Modifier.alpha(0.5F),  
                    onClick = {}  
                ) {  
                    Icon(  
                        Icons.Default.Search,  
                        contentDescription = "Search Icon",  
                        tint = Color.White  
                    )  
                }  
            },  
            trailingIcon = {  
                IconButton(  
                    onClick = {  
                        if (text.isNotEmpty()) onTextChange("")  
                        else onCloseClicked()  
                    }  
                ) {  
                    Icon(  
                        Icons.Default.Close,  
                        contentDescription = "close Icon",  
                        tint = Color.White  
                    )  
                }  
            },  
            keyboardOptions = KeyboardOptions(  
                imeAction = ImeAction.Search  
            ),  
            keyboardActions = KeyboardActions(  
                onSearch = {onSearchClicked(text)}  
            ),  
            colors = TextFieldDefaults.colors(  
                focusedContainerColor = Color.Transparent,  
                unfocusedContainerColor = Color.Transparent  
            )  
        )  
    }  
  
}

```


# Create an enum class

```kotlin

enum class SearchWidgetState{  
    OPENED,  
    CLOSED  
}

```


# Create the viewModel Implementation

```kotlin

class MainViewModel: ViewModel() {  

    private val _searchWidgetSate: MutableState<SearchWidgetState> =  
        mutableStateOf(value = SearchWidgetState.CLOSED)  
    val searchWidgetState: State<SearchWidgetState> = _searchWidgetSate  
  
    private val _searchTextState: MutableState<String> =  
        mutableStateOf(value = "")  
    val searchTextState: State<String> = _searchTextState  
  
    fun updateSearchWidgetState(newValue: SearchWidgetState) {  
        _searchWidgetSate.value = newValue  
    }  
  
    fun updateSearchTextState(newValue: String) {  
        _searchTextState.value =newValue  
    }  
  
}	

```


# Create the top bar

```kotlin

@OptIn(ExperimentalMaterial3Api::class)  
@Composable  
fun DefaultAppBar(onSearchClicked: () -> Unit) {  
    TopAppBar(  
        title = {Text(text = "Home")},  
        actions = {  
            IconButton(  
                onClick = {onSearchClicked()},  
            ) {  
                Icon(  
                    Icons.Default.Search,  
                    contentDescription = null,  
                    tint = Color.White  
                )  
            }  
        },  
        colors = TopAppBarDefaults.topAppBarColors(  
            containerColor = Color.Magenta  
        )  
    )  
  
}

```



# Create the opened/closed implementation

This decides which App bar to show(searchbar or the default topbar)

```kotlin

@Composable  
fun MainAppBar(  
    searchWidgetState: SearchWidgetState,  
    searchTextState: String,  
    onTextChange: (String) -> Unit,  
    onCloseClicked: () -> Unit,  
    onSearchClicked: (String) -> Unit,  
    onSearchTriggered: () -> Unit  
) {  
    when(searchWidgetState){  
        SearchWidgetState.CLOSED -> {  
            DefaultAppBar(  
                onSearchClicked = onSearchTriggered  
            )  
        }  
        SearchWidgetState.OPENED -> {  
            SearchAppBar(  
                text = searchTextState,  
                onTextChange = onTextChange,  
                onCloseClicked = onCloseClicked,  
                onSearchClicked = onSearchClicked  
            )  
        }  
    }  
}

```


# Finally join them together


```kotlin

@Composable  
fun MainScreen(mainViewModel: MainViewModel) {  
  
    val searchWidgetState by mainViewModel.searchWidgetState  
    val searchTextSate by mainViewModel.searchTextState  
  
    Scaffold(  
        topBar = {  
            MainAppBar(  
                searchWidgetState = searchWidgetState,  
                searchTextState = searchTextSate,  
                onTextChange = {  
                    mainViewModel.updateSearchTextState(newValue = it)  
                },  
                onCloseClicked = {  
                    mainViewModel.updateSearchWidgetState(newValue = SearchWidgetState.CLOSED)  
                },  
                onSearchClicked = {  
                    Log.d("Searched Text", it)  
                },  
                onSearchTriggered = {  
                    mainViewModel.updateSearchWidgetState(newValue = SearchWidgetState.OPENED)  
                }  
            )  
        }  
    ){ paddingValues ->  
        Surface(  
            modifier = Modifier.padding(paddingValues = paddingValues)  
        ) {  }  
    }  
}

```


